---
import { getCollection } from "astro:content";

// Props: límites por categoría
const { limit = {} } = Astro.props;

const defaultLimit = 3;

const categories = [
  { key: "mountaineering", label: "Mountaineering" },
  { key: "trekking", label: "Trekking" },
];

const filter = ({ data }) => import.meta.env.PROD ? !data.draft : true;

// Obtener los datos por categoría
const collections = await Promise.all(
  categories.map(async ({ key, label }) => {
    const items = await getCollection(key, filter);
    return {
      key,
      label,
      items: items
        .sort((a, b) => a.data.order - b.data.order)
        .slice(0, limit[key] ?? defaultLimit)
    };
  })
);
---

<section class="py-16 bg-white">
  <div class="container mx-auto px-4">
    <div class="text-center mt-6 mb-24">
      <h2 class="text-6xl md:text-6xl font-normal mb-4 reveal underline-offset-8 underline-reveal">Choose your next adventure</h2>
      <p class="text-2xl max-w-2xl mx-auto mt-2 reveal">
        Explore our expeditions to challenge yourself, enjoy nature, and connect with the Andes.
      </p>
    </div>

    {collections.map(({ key, label, items }) => (
      items.length > 0 && (
        <div class="mb-12">
          <h3 class="text-4xl font-normal mb-6 border-b border-gray-400 pb-2">{label}</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {items.map(({ slug, data, collection }) => {
              const href = `/${collection ?? key}/${slug}`;
              return (
                <a
                  href={href}
                  class="bg-white rounded-sm shadow flex flex-col overflow-hidden hover:shadow-xl transition min-h-[370px]"
                >
                  {data.image && (
                    <div class="w-full h-[250px] overflow-hidden">
                      <img
                        src={data.image}
                        alt={data.title}
                        class="w-full h-full object-cover transform transition duration-500 hover:scale-110 hover:brightness-90"
                      />
                    </div>
                  )}

                  <div class="p-4 flex flex-col flex-1 justify-between">
                    <div>
                      <h3 class="text-lg font-semibold mb-2">{data.title}</h3>
                      <p class="text-gray-700">{data.summary ?? ""}</p>
                    </div>

                    {(data.season || data.difficulty || data.pax) && (
                      <div class="mt-4 space-y-1 text-sm text-gray-600">
                        {data.dates && (
                          <div class="flex items-center">
                            <svg class="h-6 w-6 mr-1 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span class="text-gray-700 text-base">Duration: {data.dates}</span>
                          </div>
                        )}
                        {data.season && (
                          <div class="flex items-center">
                            <svg class="h-6 w-6 mr-1 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
                            </svg>
                            <span class="text-gray-700 text-base">Availability: {data.season}</span>
                          </div>
                        )}
                        {data.difficulty && (
                          <div class="flex items-center">
                            <svg class="h-6 w-6 mr-1 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941" />
                            </svg>
                            <span class="text-gray-700 text-base">Difficulty: {data.difficulty}</span>
                          </div>
                        )}
                        {data.pax && (
                          <div class="flex items-center">
                            <svg class="h-6 w-6 mr-1 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                            </svg>
                            <span class="text-gray-700 text-base">People per Guide: {data.pax}</span>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </a>
              );
            })}
          </div>
        </div>
      )
    ))}
  </div>
</section>
